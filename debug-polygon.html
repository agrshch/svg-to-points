<!DOCTYPE html>
<html>
<head>
    <title>–û—Ç–ª–∞–¥–∫–∞ –ø–æ–ª–∏–≥–æ–Ω–∞ - —Å—Ç—Ä–µ—Å—Å–æ–≤—ã–π —Ç–µ—Å—Ç</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        canvas { border: 1px solid #000; }
    </style>
</head>
<body>
    <h1>–°–¢–†–ï–°–°–û–í–´–ô –¢–ï–°–¢: –ø–æ–ª–∏–≥–æ–Ω —Å –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é</h1>
    <canvas id="canvas" width="600" height="400"></canvas>
    <div id="results"></div>

    <script src="svg-path-extractor.js"></script>
    <script>
    (async () => {
        // –ë–æ–ª—å—à–æ–π –ø–æ–ª–∏–≥–æ–Ω –¥–ª—è —Å—Ç—Ä–µ—Å—Å–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
        const polygonSVG = `<svg viewBox="0 0 300 200">
          <polygon points="50,50 200,50 150,150" fill="none" stroke="#f39c12"/>
        </svg>`;

        console.log('üî• –°–¢–†–ï–°–°–û–í–´–ô –¢–ï–°–¢: –ø–æ–ª–∏–≥–æ–Ω —Å –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é —Ç–æ—á–µ–∫');
        console.log('–ü–æ–ª–∏–≥–æ–Ω: points="50,50 200,50 150,150"');
        
        // –¢–µ—Å—Ç —Å –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é —Ç–æ—á–µ–∫ (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å 5 = –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫)
        const extractor = new SVGPathExtractor({ pointDensity: 5 });
        const paths = await extractor.extractPoints(polygonSVG);
        
        console.log('–ò–∑–≤–ª–µ—á–µ–Ω–æ —Ç–æ—á–µ–∫:', paths[0].length);
        console.log('–ü–µ—Ä–≤—ã–µ 10 —Ç–æ—á–µ–∫:', paths[0].slice(0, 10));
        console.log('–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç–æ—á–µ–∫:', paths[0].slice(-5));
        
        // –û–∂–∏–¥–∞–µ–º—ã–µ –≤–µ—Ä—à–∏–Ω—ã —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
        const expectedVertices = [
          { x: 50, y: 50 },   // –ª–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π
          { x: 200, y: 50 },  // –ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π  
          { x: 150, y: 150 }  // –Ω–∏–∂–Ω–∏–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π
        ];
        
        console.log('\nüéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –≤–µ—Ä—à–∏–Ω—ã:');
        expectedVertices.forEach((vertex, index) => {
          const found = paths[0].some(point => 
            Math.abs(point.x - vertex.x) < 0.1 && Math.abs(point.y - vertex.y) < 0.1
          );
          console.log(`–í–µ—Ä—à–∏–Ω–∞ ${index + 1} (${vertex.x},${vertex.y}): ${found ? '‚úÖ –ù–ê–ô–î–ï–ù–ê' : '‚ùå –ù–ï –ù–ê–ô–î–ï–ù–ê'}`);
          
          if (!found) {
            // –ù–∞–π–¥–µ–º –±–ª–∏–∂–∞–π—à—É—é —Ç–æ—á–∫—É
            let closest = null;
            let minDistance = Infinity;
            paths[0].forEach(point => {
              const distance = Math.sqrt(Math.pow(point.x - vertex.x, 2) + Math.pow(point.y - vertex.y, 2));
              if (distance < minDistance) {
                minDistance = distance;
                closest = point;
              }
            });
            console.log(`   ‚ùó –ë–ª–∏–∂–∞–π—à–∞—è —Ç–æ—á–∫–∞: (${closest.x.toFixed(2)}, ${closest.y.toFixed(2)}), —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${minDistance.toFixed(2)}`);
          }
        });
        
        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const scale = 2;
        const offsetX = 50;
        const offsetY = 50;
        
        // 1. –ò–°–•–û–î–ù–´–ô –¢–†–ï–£–ì–û–õ–¨–ù–ò–ö —Ç–æ–Ω–∫–∏–º–∏ —Å–µ—Ä—ã–º–∏ –ª–∏–Ω–∏—è–º–∏
        ctx.strokeStyle = '#cccccc';
        ctx.lineWidth = 1;
        ctx.setLineDash([5, 5]); // –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è –ª–∏–Ω–∏—è
        ctx.beginPath();
        expectedVertices.forEach((vertex, index) => {
          const x = vertex.x * scale + offsetX;
          const y = vertex.y * scale + offsetY;
          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });
        ctx.closePath();
        ctx.stroke();
        ctx.setLineDash([]); // —Å–±—Ä–æ—Å –ø—É–Ω–∫—Ç–∏—Ä–∞
        
        // 2. –ò–ó–í–õ–ï–ß–ï–ù–ù–´–ï –¢–û–ß–ö–ò —Å–∏–Ω–∏–º–∏ –∫—Ä—É–∂–∫–∞–º–∏
        ctx.fillStyle = 'blue';
        paths[0].forEach((point, index) => {
          const x = point.x * scale + offsetX;
          const y = point.y * scale + offsetY;
          ctx.beginPath();
          ctx.arc(x, y, 3, 0, 2 * Math.PI);
          ctx.fill();
        });
        
        // 3. –õ–ò–ù–ò–Ø –ü–û –ò–ó–í–õ–ï–ß–ï–ù–ù–´–ú –¢–û–ß–ö–ê–ú
        ctx.strokeStyle = 'blue';
        ctx.lineWidth = 2;
        ctx.beginPath();
        paths[0].forEach((point, index) => {
          const x = point.x * scale + offsetX;
          const y = point.y * scale + offsetY;
          if (index === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
        });
        ctx.stroke();
        
        // 4. –û–ñ–ò–î–ê–ï–ú–´–ï –í–ï–†–®–ò–ù–´ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∫—Ä–∞—Å–Ω—ã–º–∏ –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 3;
        expectedVertices.forEach((vertex, index) => {
          const x = vertex.x * scale + offsetX;
          const y = vertex.y * scale + offsetY;
          
          // –†–∏—Å—É–µ–º –∫—Ä–µ—Å—Ç–∏–∫
          ctx.beginPath();
          ctx.moveTo(x - 6, y - 6);
          ctx.lineTo(x + 6, y + 6);
          ctx.moveTo(x - 6, y + 6);
          ctx.lineTo(x + 6, y - 6);
          ctx.stroke();
          
          // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –≤–µ—Ä—à–∏–Ω—ã
          ctx.fillStyle = 'red';
          ctx.font = '10px monospace';
          ctx.fillText(`V${index + 1}`, x + 8, y - 8);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
          let closest = null;
          let minDistance = Infinity;
          paths[0].forEach(point => {
            const distance = Math.sqrt(Math.pow(point.x - vertex.x, 2) + Math.pow(point.y - vertex.y, 2));
            if (distance < minDistance) {
              minDistance = distance;
              closest = point;
            }
          });
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –±–ª–∏–∂–∞–π—à–µ–π —Ç–æ—á–∫–∏
          ctx.fillStyle = minDistance < 0.1 ? 'green' : 'red';
          ctx.fillText(`${minDistance.toFixed(1)}px`, x + 8, y + 8);
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞–∂–¥–æ–π –≤–µ—Ä—à–∏–Ω—ã
        let foundVertices = 0;
        expectedVertices.forEach(vertex => {
          const found = paths[0].some(point => 
            Math.abs(point.x - vertex.x) < 0.1 && Math.abs(point.y - vertex.y) < 0.1
          );
          if (found) foundVertices++;
        });
        
        document.getElementById('results').innerHTML = `
          <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞:</h3>
          <p><strong>–í—Å–µ–≥–æ —Ç–æ—á–µ–∫:</strong> ${paths[0].length}</p>
          <p><strong>–ù–∞–π–¥–µ–Ω–æ –≤–µ—Ä—à–∏–Ω:</strong> ${foundVertices}/3 ${foundVertices === 3 ? '‚úÖ' : '‚ùå'}</p>
          <p><strong>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å:</strong> 5 (–≤—ã—Å–æ–∫–∞—è)</p>
          <hr>
          <p>üîµ –ú–∞–ª–µ–Ω—å–∫–∏–µ —Å–∏–Ω–∏–µ –∫—Ä—É–∂–∫–∏ = –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏</p>
          <p>üî¥ –ë–æ–ª—å—à–∏–µ –∫—Ä–∞—Å–Ω—ã–µ –∫—Ä—É–∂–∫–∏ = –æ–∂–∏–¥–∞–µ–º—ã–µ –≤–µ—Ä—à–∏–Ω—ã</p>
          <p>üìè –ï—Å–ª–∏ –∫—Ä–∞—Å–Ω—ã–µ –∫—Ä—É–∂–∫–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Å–∏–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏ = –ø—Ä–æ–±–ª–µ–º–∞!</p>
        `;
        
        if (foundVertices < 3) {
          console.log('üö® –ü–†–û–ë–õ–ï–ú–ê –û–ë–ù–ê–†–£–ñ–ï–ù–ê: –ù–µ –≤—Å–µ –≤–µ—Ä—à–∏–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        } else {
          console.log('‚úÖ –í—Å–µ –≤–µ—Ä—à–∏–Ω—ã –Ω–∞–π–¥–µ–Ω—ã');
        }
    })();
    </script>
</body>
</html> 